/**
 * @ Author: JunkJumper
 * @ Link: https://github.com/JunkJumper
 * @ Copyright: Creative Common 4.0 (CC BY 4.0)
 * @ Create Time: 01-10-2020 10:24:44
 * @ Modified by: JunkJumper
 * @ Modified time: 01-10-2020 11:12:48
 * @ Description:
 */

/*********************************************************/
/*                                                       */
/* p_fork_exec : Prototype extremement simplifie d' une  */
/*               boucle de SHELL  :                      */
/* - Le pere lit une commande a executer (fait)          */ 
/* - Le pere se duplique et attend la fin du fils        */
/* - Le pere affiche OK si le fils s'est "bien" fini     */
/*   (exit avec 0) et KO sinon.                          */
/*   et KO sinon.                                        */
/* - Le fils execute la commande lue par le pere         */
/*  (avec utilisation de la variable PATH).              */
/*                                                       */
/*********************************************************/

#include <stdio.h>
#include <errno.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/types.h>
#include <sys/wait.h>

int main ()

{ char *arguments[3];

  arguments[0] = (char*) malloc(30);
  arguments[1] = (char*) malloc(30); 

printf  ("\n=============================\n");
printf  (" BIENVENUE SOUS p_fork_exec  \n");
printf  ("=============================\n\n");

printf ("? Nom de la commande a executer : "); scanf  ("%s", arguments[0]);
printf ("? Un argument (obligatoire)     : "); scanf  ("%s", arguments[1]);

arguments[2] = (char*)0;

    /**********************/
    /* PARTIE A COMPLETER */
    /**********************/
    int infosRetour;
    int res = fork();
    if (res < 0)
    {
        printf("ERREUR FORK\n");
    }
    else
    {
        if (res == 0)
        { /************************** FILS ***********************/
            printf("Je suis le fils :\n");
            printf("pid : %d\n", getpid());
            printf("ppid : %d\n", getppid());
            printf("je fais la commande :\n");

            execlp(arguments[0], arguments[0], arguments[1], NULL);

            printf("\n\n");
            exit(0);
        }
        else
        { /************************** PERE ***********************/
            wait(&infosRetour);
            printf("Je suis le pÃ¨re :\n");
            printf("pid : %d\n", getpid());
            printf("ppid : %d\n", getppid());
            printf("%d", WEXITSTATUS(infosRetour));


            printf("\n\n");
        }
    }

    return 0;
}
